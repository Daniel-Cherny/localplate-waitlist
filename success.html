<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to LocalPlate! - You're on the List</title>
    <meta name="description" content="Success! You're on the LocalPlate waitlist. Get ready for verified nutrition data from your favorite local restaurants.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%2310b981'/%3E%3C/svg%3E">
    
    <!-- Fonts - Premium Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'; this.onload=null;">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white antialiased overflow-x-hidden">
    
    <!-- Noise Texture Overlay -->
    <div class="noise-overlay"></div>
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white/95 dark:bg-gray-900/95 backdrop-blur-lg z-50 border-b border-gray-100 dark:border-gray-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <a href="index.html" class="flex items-center space-x-3">
                    <svg class="w-8 h-8 logo-spin" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="20" fill="url(#gradient-plate)"/>
                        <circle cx="14" cy="20" r="3" fill="#ef4444" class="animate-pulse-slow"/>
                        <circle cx="24" cy="18" r="3" fill="#f59e0b" class="animate-pulse-slow animation-delay-100"/>
                        <circle cx="34" cy="20" r="3" fill="#84cc16" class="animate-pulse-slow animation-delay-200"/>
                        <rect x="22" y="28" width="4" height="12" rx="2" fill="#6b7280"/>
                        <defs>
                            <linearGradient id="gradient-plate" x1="0" y1="0" x2="48" y2="48">
                                <stop stop-color="#10b981"/>
                                <stop offset="1" stop-color="#059669"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <span class="text-xl font-bold bg-gradient-to-r from-emerald-600 to-emerald-500 bg-clip-text text-transparent">
                        LocalPlate
                    </span>
                </a>
                
                <!-- Theme Toggle -->
                <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-all hover:scale-110" aria-label="Toggle dark mode">
                    <svg class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                    </svg>
                    <svg class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-50"></canvas>
    
    <!-- Hero Section with Ken Burns Effect -->
    <section class="relative min-h-screen flex items-center justify-center pt-16 overflow-hidden">
        <!-- Background Image with Ken Burns -->
        <div class="absolute inset-0 ken-burns-container">
            <div class="ken-burns-image"></div>
        </div>
        
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-white/80 via-white/70 to-white/90 dark:from-gray-900/80 dark:via-gray-900/70 dark:to-gray-900/90"></div>
        
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="max-w-2xl mx-auto">
            
            <!-- Success Card -->
                <!-- Success Card -->
                <div class="success-card text-center animate-fade-in-up">
                
                <!-- Success Icon -->
                <div class="success-icon-wrapper">
                    <div class="w-20 h-20 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-success-pulse relative z-10 shadow-xl">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                </div>
                
                <!-- Heading -->
                <h1 class="font-serif text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent animate-fade-in-up animation-delay-100">
                    You're on the List!
                </h1>
                
                <!-- Subheading -->
                <p class="text-xl text-gray-600 dark:text-gray-300 mb-8 animate-fade-in-up animation-delay-200">
                    Welcome to LocalPlate, <span id="user-email" class="font-medium text-gray-900 dark:text-white">friend</span>!
                </p>
                <!-- Referral Section -->
                <div class="form-card mb-8 animate-fade-in-up animation-delay-100">
                    <h2 class="text-2xl font-bold mb-3">Move Up the List!</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">
                        Share your unique referral link. Each friend who joins moves you up!
                    </p>
                    
                    <!-- Referral Link -->
                    <div class="flex items-center space-x-2 mb-4">
                        <input 
                            type="text" 
                            id="referral-link" 
                            readonly 
                            value="https://localplate.com/waitlist?ref=ABC123"
                            class="flex-1 bg-white/90 dark:bg-gray-800/90 px-3 py-2 rounded-lg text-sm text-gray-700 dark:text-gray-300 focus:outline-none"
                        >
                        <button 
                            onclick="copyLink()" 
                            class="btn-primary"
                        >
                            Copy
                        </button>
                    </div>
                    
                    <!-- Share Buttons -->
                    <div class="flex flex-col sm:flex-row justify-center gap-3">
                        <button onclick="shareTwitter()" class="btn-secondary flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                            <span>Share on X</span>
                        </button>
                        
                        <button onclick="shareLinkedIn()" class="btn-secondary flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                            <span>Share on LinkedIn</span>
                        </button>
                        
                        <button onclick="shareEmail()" class="btn-secondary flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <span>Email</span>
                        </button>
                    </div>
                </div>
                
                <!-- Referral Progress -->
                <div class="form-card mb-8 animate-fade-in-up animation-delay-200">
                    <h3 class="text-xl font-bold mb-8 text-center font-serif">Your Referral Rewards</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <!-- Tier 1 - Active -->
                        <div class="text-center group hover:scale-105 transition-transform duration-300">
                            <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:shadow-lg transition-shadow">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                                </svg>
                            </div>
                            <div class="font-bold text-emerald-600 dark:text-emerald-400 mb-1">1 Referral</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">Early Access Badge</div>
                            <div class="text-xs font-medium text-gray-500" id="referral-1">0/1</div>
                        </div>
                        
                        <!-- Tier 2 - Locked -->
                        <div class="text-center group hover:scale-105 transition-transform duration-300 opacity-50">
                            <div class="w-16 h-16 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:shadow-lg transition-shadow">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
                                </svg>
                            </div>
                            <div class="font-bold text-gray-600 dark:text-gray-400 mb-1">3 Referrals</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">One Month Free</div>
                            <div class="text-xs font-medium text-gray-500" id="referral-3">0/3</div>
                        </div>
                        
                        <!-- Tier 3 - Locked -->
                        <div class="text-center group hover:scale-105 transition-transform duration-300 opacity-50">
                            <div class="w-16 h-16 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:shadow-lg transition-shadow">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                                </svg>
                            </div>
                            <div class="font-bold text-gray-600 dark:text-gray-400 mb-1">5 Referrals</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">Swag Pack</div>
                            <div class="text-xs font-medium text-gray-500" id="referral-5">0/5</div>
                        </div>
                    </div>
                </div>
                
                <!-- What's Next -->
                <div class="form-card mt-8 animate-fade-in-up animation-delay-300">
                    <h3 class="text-xl font-bold mb-6 text-center font-serif">What Happens Next?</h3>
                    <div class="text-left space-y-3 text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span>Check your email for confirmation and updates</span>
                        </div>
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span>We'll notify you when early access opens</span>
                        </div>
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span>Share to move up and get rewards!</span>
                        </div>
                    </div>
                </div>
                
                <!-- Back to Home -->
                <div class="mt-8">
                    <a href="index.html" class="text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 font-medium transition-colors">
                        ← Back to Home
                    </a>
                </div>
            </div>
            
                <!-- Follow Us -->
                <div class="text-center mt-8 animate-fade-in-up animation-delay-200">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Follow us for updates</p>
                <div class="flex justify-center space-x-4">
                    <a href="#" class="text-gray-500 hover:text-emerald-600 dark:text-gray-400 dark:hover:text-emerald-400 transition-all hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </a>
                    <a href="#" class="text-gray-500 hover:text-emerald-600 dark:text-gray-400 dark:hover:text-emerald-400 transition-all hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                        </svg>
                    </a>
                    <a href="#" class="text-gray-500 hover:text-emerald-600 dark:text-gray-400 dark:hover:text-emerald-400 transition-all hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="20" fill="url(#gradient-plate-footer)"/>
                        <circle cx="14" cy="20" r="3" fill="#ef4444"/>
                        <circle cx="24" cy="18" r="3" fill="#f59e0b"/>
                        <circle cx="34" cy="20" r="3" fill="#84cc16"/>
                        <rect x="22" y="28" width="4" height="12" rx="2" fill="#6b7280"/>
                        <defs>
                            <linearGradient id="gradient-plate-footer" x1="0" y1="0" x2="48" y2="48">
                                <stop stop-color="#10b981"/>
                                <stop offset="1" stop-color="#059669"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <span class="text-lg font-semibold text-gray-900 dark:text-white">LocalPlate</span>
                </div>
                
                <!-- Links -->
                <div class="flex space-x-6 text-sm text-gray-600 dark:text-gray-400">
                    <a href="#" class="hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">Privacy</a>
                    <a href="#" class="hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">Terms</a>
                    <a href="#" class="hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">Contact</a>
                </div>
                
                <!-- Copyright -->
                <p class="text-sm text-gray-500 dark:text-gray-500">
                    © 2025 LocalPlate. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Copy Toast -->
    <div id="copy-toast" class="hidden fixed bottom-4 right-4 bg-emerald-600 text-white px-6 py-3 rounded-lg shadow-lg animate-slide-up">
        <div class="flex items-center space-x-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            <span>Link copied to clipboard!</span>
        </div>
    </div>
    
    <script>
        // CRITICAL: Guard against false positives - verify user actually submitted form
        (function validateSuccessPage() {
            const email = sessionStorage.getItem('waitlist_email');
            const referralCode = sessionStorage.getItem('waitlist_referral_code');
            const timestamp = sessionStorage.getItem('waitlist_timestamp');
            
            // Check if required data exists
            if (!email || !referralCode || !timestamp) {
                console.error('[SUCCESS GUARD] Missing required session data', {
                    hasEmail: !!email,
                    hasReferralCode: !!referralCode,
                    hasTimestamp: !!timestamp
                });
                // Store error for debugging
                localStorage.setItem('localplate:successError', JSON.stringify({
                    at: Date.now(),
                    error: 'Missing session data',
                    hasEmail: !!email,
                    hasReferralCode: !!referralCode,
                    hasTimestamp: !!timestamp
                }));
                // Redirect to home
                window.location.replace('index.html');
                return;
            }
            
            // Validate timestamp is recent (within 60 seconds)
            const submittedAt = parseInt(timestamp, 10);
            const now = Date.now();
            const ageMs = now - submittedAt;
            
            if (isNaN(submittedAt) || ageMs > 60000 || ageMs < 0) {
                console.error('[SUCCESS GUARD] Invalid or expired timestamp', {
                    timestamp,
                    ageMs,
                    maxAge: 60000
                });
                // Store error for debugging
                localStorage.setItem('localplate:successError', JSON.stringify({
                    at: now,
                    error: 'Expired or invalid timestamp',
                    ageMs,
                    timestamp
                }));
                // Clear stale data
                sessionStorage.removeItem('waitlist_email');
                sessionStorage.removeItem('waitlist_referral_code');
                sessionStorage.removeItem('waitlist_timestamp');
                sessionStorage.removeItem('waitlist_inserted_id');
                // Redirect to home
                window.location.replace('index.html');
                return;
            }
            
            console.log('[SUCCESS GUARD] Validation passed', {
                email,
                referralCode,
                ageMs: ageMs + 'ms'
            });
        })();
        
        // Debug mode check
        const DEBUG = new URLSearchParams(location.search).has('debug');
        
        // Get user data from session storage (already validated above)
        const email = sessionStorage.getItem('waitlist_email');
        const referralCode = sessionStorage.getItem('waitlist_referral_code');
        
        // Position handling - disable fake positions in debug mode
        let position;
        if (DEBUG) {
            position = sessionStorage.getItem('waitlist_position') || 'UNKNOWN';
            if (position === 'UNKNOWN') {
                console.warn('[DEBUG] No real position found - fake position disabled');
            }
        } else {
            position = sessionStorage.getItem('waitlist_position') || Math.floor(Math.random() * 500) + 1000;
        }
        
        // Update page with user data
        if (email) {
            document.getElementById('user-email').textContent = email;
        }
        
        if (referralCode) {
            const referralLink = `${window.location.origin}/waitlist?ref=${referralCode}`;
            document.getElementById('referral-link').value = referralLink;
        }
        // Confetti animation
        function launchConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confetti = [];
            const colors = ['#10b981', '#059669', '#0d9488', '#0891b2', '#f59e0b', '#ef4444'];
            
            for (let i = 0; i < 150; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 5 + 3,
                    vx: Math.random() * 2 - 1,
                    vy: Math.random() * 3 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    angle: Math.random() * 360
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                confetti.forEach((c, index) => {
                    c.y += c.vy;
                    c.x += c.vx;
                    c.angle += 3;
                    
                    ctx.save();
                    ctx.translate(c.x, c.y);
                    ctx.rotate(c.angle * Math.PI / 180);
                    ctx.fillStyle = c.color;
                    ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h);
                    ctx.restore();
                    
                    if (c.y > canvas.height) {
                        confetti.splice(index, 1);
                    }
                });
                
                if (confetti.length > 0) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }
        
        // Launch confetti on load
        setTimeout(launchConfetti, 500);
        
        // Copy link function
        function copyLink() {
            const input = document.getElementById('referral-link');
            input.select();
            document.execCommand('copy');
            
            // Show toast
            const toast = document.getElementById('copy-toast');
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // Share functions
        function shareTwitter() {
            const url = document.getElementById('referral-link').value;
            const text = "I just joined the @LocalPlate waitlist! Get verified nutrition data from your favorite local restaurants. Join me:";
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        }
        
        function shareLinkedIn() {
            const url = document.getElementById('referral-link').value;
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank');
        }
        
        function shareEmail() {
            const url = document.getElementById('referral-link').value;
            const subject = "Join me on LocalPlate!";
            const body = `Hey! I just joined the LocalPlate waitlist and thought you might be interested too. 

LocalPlate provides verified nutrition data from local restaurants, making it easy to track your nutrition goals while supporting neighborhood spots.

Join using my referral link: ${url}`;
            
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Dark mode toggle functionality
        function initDarkMode() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            
            // Check for saved theme preference or default to light
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark' || (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                html.classList.add('dark');
            }
            
            themeToggle?.addEventListener('click', () => {
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            });
        }
        
        // Initialize dark mode
        initDarkMode();
    </script>
</body>
</html>